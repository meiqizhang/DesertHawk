{% extends 'base.html' %}
{% load static %}
{% block title %}
    程序设计
{% endblock %}

{% block mycss %}
    {{ block.super }}
    <link href="{% static 'css-theme/' %}{{ THEME }}{{ '/programing.css' }}" rel="stylesheet">

{% endblock %}

{% block content %}
    <style>
        #category-btn{
            -moz-user-select: none; /*火狐*/
            -webkit-user-select: none; /*webkit浏览器*/
            -ms-user-select: none; /*IE10*/
            -khtml-user-select: none; /*早期浏览器*/
            -o-user-select: none; /* Opera*/
            user-select: none;
        }
    </style>
    <h2 class="ctitle">{{ category }}</h2>
    <div class="rnav">
            {% for category in categories %}
                <li>
                    <a id="category-btn" href="/articles/programing?category={{ category }}">{{ category }}</a>
                </li>
            {% endfor %}
        </ul>
    </div>
    <div style="margin-top: 24px; ">
        <ul class="article-list">
            {% for darticle in articles %}
                <li>
                    <div class="row">
                        <img class="article-figure col-lg-4 col-md-4 col-sm-12 col-xs-12" style="height:auto; border-radius: 1px" id="image-{{ darticle.article_id }}" title="{{ darticle.title }}" src="/static/images/loading.gif">
                        <div class="col-md-8 col-md-8 col-sm-10 col-xs-10">
                            <h2>{{ darticle.title }}</h2>
                            <div class="article-description">{{ darticle.description }}</div>
                        </div>
                    </div>
                    <a href="/articles/p/{{ darticle.article_id }}.html" class="read-more">阅读全文&gt;&gt;</a>
                </li>
            {% endfor %}
        </ul>
    </div>
    <div class="pages">
        <a class="prev-page"><</a>
        <a class="next-page">></a>
        <label id="total-pages" style="margin-left: 0; margin-top: 6px">共{{total_pages}}页</label>
    </div>
    <script>
        let totalPages = parseInt({{ total_pages }});
        let curPage = parseInt({{ page }})

        /*分页处理太麻烦了，简单粗暴的方法往往更有效*/
        let idx = 1
        if (curPage <= 10) {
            idx = 1
        } else if (curPage <= 21) {
            idx = 11
        } else if (curPage <= 31) {
            idx = 21
        }
        for (let i = idx; i <= totalPages && i < idx + 10; i++) {
            let obj = $('<a href="#">' + i + '</a>').insertBefore($('.next-page'))
            console.log(obj.text())
            if (i === curPage) {
                obj.addClass('active');
            }
            {% if category == "程序设计" %}
                obj.attr('href', '/articles/programing?page=' + i)
            {% else %}
                obj.attr('href', '/articles/programing?category={{ category }}&page=' + i)
            {% endif %}
        }

        if (curPage === 1) {
            $('.prev-page').addClass('hidden')
        } else if (curPage === totalPages) {
            $('.next-page').addClass('hidden')
        }
        $('.pages > a').unbind('click').click(function (){
            let text = $(this).text()
            if (text === '<') {
                window.location.href = "/?page=" + (curPage - 1)
            } else if (text === '>') {
                window.location.href = "/?page=" + (curPage + 1)
            } else {
                let pageId = parseInt($(this).text());
            }
        })

        $(document).ready(function(){
            $(".article-figure").each(function() {
                {#所有的图标都是3*5#}
                image_download_and_set($(this).attr("id"), "/articles/d_icon/?title=" + $(this).attr("title"))
                let width =$(this).width()
                $(this).height(width * 3 / 5)
            })
        })
    </script>
{% endblock %}





{% load static %}

<link REL="SHORTCUT ICON" HREF="{% static "images/home.png" %}"/>

<!DOCTYPE html>
<html>
<head>
    <script src="/static/ckeditor/ckeditor/ckeditor.js"></script>
    <meta name="baidu-site-verification" content="WmM9Nymwhq" />
    <link href="https://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://pv.sohu.com/cityjson?ie=utf-8"></script>
    <script src="https://how2j.cn/study/js/jquery/2.0.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="http://lib.h-ui.net/jquery.form/3.51.0/jquery.form.min.js"></script>
    {% block mycss %}
    {% endblock %}

    <title>
        {% block title %}
            愿你历尽千帆，归来仍是少年
        {% endblock %}
    </title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="origin">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    {% block meta %}
    {% endblock %}

    <link id="baseCss" rel="stylesheet" />
    <link href="{% static 'css-theme/' %}{{ THEME }}{{ '/base.css' }}"  rel="stylesheet">
    <link href="{% static 'css-theme/' %}{{ THEME }}{{ '/index.css' }}" rel="stylesheet">

    <script src="{% static 'js/modernizr.js' %}"></script>
    <script src="{% static 'js/scrollReveal.js' %}"></script>
    <script src="{% static 'js/article/request-image.js' %}"></script>
    <script src="{% static 'js/map/echarts.min.js' %}"></script>
    <script src="{% static 'js/map/china.js' %}"></script>
    <link href="https://cdn.bootcdn.net/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

    <SCRIPT>
        $.ajaxSetup({
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'}
        })
        function getWidth() {
            var winWidth;
            if(window.innerWidth) {
                winWidth = window.innerWidth;
            } else if((document.body) && (document.body.clientWidth)) {
                winWidth = document.body.clientWidth;
            }
            return winWidth;
        }
        toastr.options = {
            closeButton: false,
            debug: false,
            progressBar: false,
            onclick: null,
            showDuration: "300",
            hideDuration: "1000",
            timeOut: "2000",
            extendedTimeOut: "1000",
            positionClass: "toast-top-center",
      };
    </SCRIPT>
</head>
<body>
<header>
    <script type="text/javascript">
        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays*24*60*60*1000));
            var expires = "expires=" + d.toGMTString();
            if (exdays > 0) {
                document.cookie = cname + "=" + cvalue + "; " + expires;
            } else {
                document.cookie = cname + "=" + cvalue;
            }
        }

        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for(var i=0; i<ca.length; i++) {
                var c = ca[i].trim();
                if (c.indexOf(name) === 0) {
                    return c.substring(name.length,c.length);
                }
            }
            return "";
        }

        function getAddress() {
            var ip = returnCitySN.cip; //客户端ip
            $.getJSON("https://api.map.baidu.com/location/ip?callback=?", {
                'ak': 'x2CC5dtMtwjAAe6epLt2s1Kxs0BmSxPu',
                'coor': 'bd09ll',
                'ip': ip
            }, function(data) {
                var x = data.content.point.x;//经度
                var y = data.content.point.y;//纬度
                var address = data.content.address;//所在市
                req = {}
                req["ip"] = ip;
                req["x"] = x;
                req["y"] = y;
                req["address"] = address;

                setVisit(req);
                setCookie("ip", req["ip"], 0);
                setCookie("address", req["address"], 0);
            });
        }

        function setVisit(req) {
            $.ajax({
            type:'GET',
            data: req,
            url:'{% url 'statistic:set' %}',
            datatype:JSON,
                success:function (data) {
                },
                error:function () {
                }
            });
        }

        ip = getCookie("ip")
        if (ip === ""){
            getAddress();
        }

        var a_idx = 0;
        jQuery(document).ready(function($) {
            $("body").click(function(e) {
                var a = new Array("❤富强❤","❤民主❤","❤文明❤","❤和谐❤","❤自由❤","❤平等❤","❤公正❤","❤法治❤","❤爱国❤","❤敬业❤","❤诚信❤","❤友善❤");
                var $i = $("<span></span>").text(a[a_idx]);
                a_idx = (a_idx + 1) % a.length;
                var x = e.pageX,
                y = e.pageY;
                $i.css({
                    "z-index": 9999999999999999999999999999999999999999,
                    "top": y - 20,
                    "left": x,
                    "position": "absolute",
                    "font-weight": "bold",
                    "color": "rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"
                });
                $("body").append($i);
                $i.animate({
                    "top": y - 180,
                    "opacity": 0
                },
                1500,
                function() {
                    $i.remove();
                });
            });
        });
    </script>

    <div class="logo" data-scroll-reveal="enter right over 1s">
        <a><b>愿你历尽千帆，归来仍是少年</b></a>
    </div>

 <div class="rowx">
    <div id="top-nav-layout" class="hidden">
        <nav class="topnav row" data-scroll-reveal="enter bottom over 0.8s after 0.8s">
            <div class="col-md-10">
                <a href="{% url 'home:home' %}">
                    <span>首页</span>
                </a>
                <a href="/aboutme/">
                    <span>关于我</span>
                </a>

                <a href="/articles/programing">
                    <span>程序设计</span>
                </a>

                <a href="/articles/programing">
                    <span>旅行摄影</span>
                </a>

                <a href="{% url 'document:list' %}">
                    <span>文档资源</span>
                </a>

                <a href="{% url 'gbook:list' %}" >
                    <span>留言</span>
                </a>
            </div>
            <div class="search_div col-md-2">
                <form method="get" action="/search/">
                    {% if key_word %}
                        <input id="key_word" type="text" name="keyword" value={{ key_word }} />
                    {% else %}
                        <input type="text" name="keyword" placeholder=" 站内搜索..." />
                    {% endif %}
                </form>
            </div>
        </nav>
    </div>
 </div>
</header>

<script>
    $(function(){
        $.ajax({
                type:'GET',
                url:'{% url 'statistic:get' %}',
                datatype:JSON,
                success:function (data) {
                    draw(data);
                },
                error:function () {
                    console.log('ajax刷新分页数据失败！');
                }
            });

        //初始化echarts实例
        function draw(data) {
            result = $.parseJSON(data);
            visitData = []
            for (i = 0; i < result.data.length; ++i) {
                visitData.push([result.data[i].x, result.data[i].y, result.data[i].count, result.data[i].city])
            }
            var optionMap = {
                /*visualMap: {
                    bottom: 50, left: 30, min: 0, max: 500, splitNumber: 5,
                    inRange: {color: ['#d94e5d', '#eac736', '#50a3ba'].reverse()},
                    textStyle: {color: '#fff00'}
                },*/
                 tooltip: {
                     /*返回需要的信息*/
                     formatter: function (param) {
                         var value = param.value;
                         return '<div style="border-bottom: 1px solid rgba(255,255,255,.3); font-size: 16px;padding-bottom: 7px;margin-bottom: 7px;"> ' +
                                    value[3] + '(' + value[2] + ')' +
                                '</div>';
                     }
                 },
                geo: {
                    map: 'china',
                    label: {
                        emphasis: {
                            show: false
                        }
                    },
                    roam: true,
                    itemStyle: {
                        normal: {areaColor: '#ffffff', borderColor: 'rgba(66, 203, 232, 0.63)'},
                        emphasis: {areaColor: '#00ff'}
                    }
                },
                series: [{
                    type: 'scatter',
                    //symbolSize: 10,
                    coordinateSystem: 'geo',
                    /*data: convertData([
                    {name: "海门", value: 405},
                ])*/
                    data: visitData,//[[121.15, 31.89, 405]]
                    symbolSize: function (data) {
                        //return  data[2] * 1;
                        var size = new Array()
                        for (var i = 0; i <= 12; i++) {
                            size[i] = i;
                        }

                        var idx = parseInt(data[2] / 10 +1 );
                        if (idx > 12){
                            idx = 12;
                        }
                        return size[idx];
                    },
                    itemStyle: { //基调颜色
                        normal: {
                            color: function (data) {
                                var idx = parseInt(data.data[2]);
                                idx = 130 - idx;
                                if (idx < 0) {
                                    idx = 0;
                                }

                                var delt = Number(idx).toString(16);
                                delt += "";
                                if (delt.length < 2) {
                                    delt += "0";
                                }
                                var color = "#FF" + delt + delt;
                                return color;
                            }
                        }
                    },
                }]
            };
            var myChart = echarts.init(document.getElementById('site-statistic'));
            myChart.setOption(optionMap);
        }
 });
</script>

<div id="main-container" class="container show" style="width: 100%">
    <div class="row">
        <div id="statistic-bar" class="col-xs-0 col-0 col-sm-0 col-md-0 col-lg-0 hidden">
            <div class="container" style="width: 100%;">
                <div class="row" style="text-align: center">
                    <div id="site-statistic" class="col-sm-12 col-md-12"></div>
                    <p>您是小站的第<span style="color: red"> {{ VISIT_COUNT }} </span>位访客，欢迎~</p>
                </div>
            </div>
        </div>
        <div id="article-bar" class="col-xs-12 col-12 col-sm-12 col-md-12 col-lg-6 hidden">
{#            <article>#}
            <div class="my-container" >
                {% block content %}
                {% endblock %}
            </div>
{#            </article>#}
            <hr style="border: 1px solid rgba(52, 73, 94, 0.54)">
            <div>
                <div class="my-links">
                    <span>联系我：</span>
                    <a href="https://github.com/meiqizhang/DesertHawk" target="_blank">github</a>
                    <a href="https://blog.csdn.net/zhangqi_gsts" target="_blank">csdn</a>
                    <a>QQ<img style="width:0; height: 0; position: absolute" src="https://content-image-1251916339.cos.ap-beijing.myqcloud.com/2021/11/qq-QR.png"></a>
                    <a>微信<img style="width:0; height: 0; position: absolute" src="https://content-image-1251916339.cos.ap-beijing.myqcloud.com/2021/11/wechat-QR.png"></a>
                </div>
                <div class="out-links">
{#                    友情链接：#}
                    <a href="https://www.tjcblog.com/" target="_blank" >杨青青个人博客</a>
                    <a href="https://wenyuanblog.com/" target="_blank" >文渊博客</a>
                    <a href="https://www.hmchang.com/" target="_blank" >黄茂昌个人博客</a>
                    <a href="http://www.hcgzc.cn/" target="_blank" title="抖音剧本">抖音剧本</a>
                    <a href="https://www.laoliubiji.com/" target="_blank" title="老刘笔记">老刘笔记</a>
                    <a href="https://c69p.com/" target="_blank" title="陈大剩博客">陈大剩博客</a>
                    <a href="https://xuqssq.com/" target="_blank" title="XuQian博客">XuQian博客</a>
                    <a href="https://www.biiiiii.com/" target="_blank" title="舍逸斋个人博客">舍逸斋个人博客</a>
                    <a href="https://www.dreamwings.cn/" target="_blank" title="继续踏上旅途，在没有你的春天……">千千</a>
                    <a href="https://www.itkuniao.com/" target="_blank" title="IT酷鸟">IT酷鸟</a>
                    <a href="https://www.duanliang920.com" target="_blank" title="段亮博客">段亮博客</a>
                    <a href="http://www.77ketang.com" target="_blank" title="7分钟课堂">7分钟课堂</a>
                    <a href="https://www.feizhimeng.com" target="_blank" title="记录和分享水文地质,工程地质,环境地质相关知识的个人站点。">飞之梦工作室</a>
                    <a href="https://www.yaohuanet.com/" target="_blank" title="云月怡博客">云月怡博客</a>
                    <a href="http://www.old-wan.com/" target="_blank" title="西安SEO优化">西安SEO优化</a>
                    <a href="http://gsht.nszbf.me/" target="_blank" title="面向生活，发现美好 博客">NS.ZBF 博客</a>
                    <a href="http://benblog.cn" target="_blank" title="严与律己宽于律人">ben's blog</a>
                    <a href="https://honto.cc/" target="_blank" title="分享一些自己工作中遇到的问题和学习时候遇到的问题，并把难点拆分成若干个知识点通过图文和视频分享出来。">鸿来博客园</a>
                    <a href="https://www.deep-os.com/" target="_blank" title="linux运维">linux运维</a>
                    <a href="https://lidada.cn/" target="_blank" title="一个专注于互联网运营的伪CISE个人网站">李大大个人博客</a>
                    <a href="http://www.sunfahui.com/" target="_blank" title="灰灰个人博客">灰灰个人博客</a>
                    <a href="https://www.piyao8.cn/" target="_blank">辟谣吧个人博客</a>
                    <a href="http://www.shmianfei.com/" target="_blank">周朝阳博客</a>
                    <a href="https://www.jguok.com/" target="_blank">坚果壳</a>
                    <a href="https://zsh2401.top/" target="_blank">2401的晚秋咖啡 </a>
                    <a href="https://www.usuuu.com/" target="_blank">悠悠个人博客</a>
                    <a href="https://www.cuiwenyuan.com/" target="_blank">崔文远的个人网站</a>
                    <a href="https://www.frbkw.com/" target="_blank">枫瑞博客</a>
                    <a href="https://wxy97.com/" target="_blank">王旭阳个人博客</a>
                    <a href="https://www.biiiiii.com" target="_blank">舍逸斋</a>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
        $('.my-links > a').mouseenter(function (e) {
            let top = $(this).offset().top;
            let left = $(this).offset().left;
            let text = $(this).text()
            if (text === 'QQ' || text === "微信") {
                top -= 140
                left -= 45
                $(this).children("img").offset({ top: top, left: left}).css("width", "130px").css('height', '130px')
            }
        }).mouseout(function(){
             let text = $(this).text()
            if (text === 'QQ' || text === "微信") {
                $(this).children("img").css("width", "0").css('height', '0')
            }
        })


    var screenWidth = getWidth();
    console.log("width=" + screenWidth);
     if (screenWidth > 1700) {
        $("#statistic-bar").attr("class", "col-xs-0 col-0 col-sm-0 col-md-0 col-lg-3 show");
        $("#article-bar").attr("class", "col-xs-12 col-12 col-sm-12 col-md-12 col-lg-6 show");
        $("#calendar-bar").attr("class", "col-xs-0 col-0 col-sm-0 col-md-0 col-lg-3 show");
        $("#top-nav-layout").attr("class", "col-xs-offset-3 col-sm-offset-3 col-md-offset-3 col-lg-offset-3 col-xs-6 col-sm-6 col-md-6 col-lg-6");
    }
     else  if (screenWidth > 1600) {
        $("#statistic-bar").attr("class", "col-xs-2 col-3 col-sm-3 col-md-3 col-lg-3 show");
        $("#article-bar").attr("class", "col-xs-6 col-6 col-sm-6 col-md-6 col-lg-6 show");
        $("#calendar-bar").attr("class", "col-xs-3 col-3 col-sm-3 col-md-3 col-lg-3 show");
        $("#top-nav-layout").attr("class", "col-xs-offset-3 col-sm-offset-3 col-md-offset-3 col-lg-offset-3 col-xs-8 col-sm-8 col-md-8 col-lg-8");
    }
    else if (screenWidth > 1480) {
        $("#statistic-bar").attr("class", "col-xs-2 col-2 col-sm-2 col-md-2 col-lg-2 show");
        $("#article-bar").attr("class", "col-xs-8 col-8 col-sm-8 col-md-8 col-lg-8 show");
        $("#calendar-bar").attr("class", "col-xs-2 col-2 col-sm-2 col-md-2 col-lg-2 show");
        $("#top-nav-layout").attr("class", "col-xs-offset-2 col-sm-offset-2 col-md-offset-2 col-lg-offset-2 col-xs-8 col-sm-8 col-md-8 col-lg-8");
    } else if (screenWidth > 1280) {
        $("#article-bar").attr("class", "col-xs-offset-2 col-sm-offset-2 col-md-offset-2 col-lg-offset-2 col-xs-8 col-8 col-sm-8 col-md-8 col-lg-8 show");
        $("#statistic-bar").attr("class", "hidden");
        $("#calendar-bar").attr("class", "hidden");
        $("#top-nav-layout").attr("class", "col-xs-offset-2 col-sm-offset-2 col-md-offset-2 col-xs-8 col-sm-8 col-md-8 col-lg-8");
    } else {
        $("#article-bar").attr("class", "col-xs-offset-1 col-sm-offset-1 col-md-offset-1 col-lg-offset-1 col-xs-10 col-10 col-sm-10 col-md-10 col-lg-10 show");
        $("#statistic-bar").attr("class", "hidden");
        $("#calendar-bar").attr("class", "hidden");
        $("#top-nav-layout").attr("class", "col-xs-offset-1 col-sm-offset-1 col-md-offset-1 col-xs-10 col-sm-10 col-md-10 col-lg-10");
    }
</script>

<footer style="margin-top: 10px; margin-bottom: 10px">
    <span style="color: grey">
        <a style="color: grey" href="http://beian.miit.gov.cn">粤ICP备20054363号</a> | 博客已运行<span class="run_time"></span>
    </span>
</footer>

<script>
    if (!(/msie [6|7|8|9]/i.test(navigator.userAgent))) {
        (function () {
            window.scrollReveal = new scrollReveal({reset: true});
        })();
    }
    $(function(){
        var start_time = 0;
        $.ajax({
            type:'GET',
            url: '/starttime/',
            datatype:JSON,
            async: false,
            success:function (timestamp) {
                start_time = timestamp;
                update_run_time();
            },
            error:function () {
                console.log('ajax刷新分页数据失败！');
            }
        })

        function update_run_time() {
            var startDate = parseInt(start_time);
            var endDate = parseInt(Date.parse(new Date()) / 1000);

            var seconds = endDate - startDate;
            var years = parseInt(seconds / (24 * 3600 * 356));
            if (years > 0){
                seconds = parseInt(seconds % (years * 24 * 3600 * 356));
            } else {
                years = 0;
            }

            var days = parseInt(seconds / (24 * 3600));
            if (days > 0) {
                seconds = parseInt(seconds % (days * 24 * 3600));
            } else{
                days = 0;
            }

            var hours = parseInt(seconds / 3600);
            if (hours > 0){
                seconds = parseInt(seconds % (hours * 3600));
            } else {
                hours = 0;
            }

            var minutes = parseInt(seconds / 60);
            if (minutes > 0){
				seconds = parseInt(seconds % 60);
            } else {
                minutes = 0;
            }

            var run = years + " 年 " + days + " 天 " + hours + " 小时 " + minutes + " 分钟 " + seconds + " 秒";
            $(".run_time").html(run);
        }

        function showAuto(){
            if (start_time > 0){
                update_run_time();
            }
        }
        setInterval(showAuto, 1000);
    })

</script>
{% block my_js %}

{% endblock %}

</body>
</html>
